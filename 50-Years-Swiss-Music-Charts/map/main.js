function isTouch(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}function addSocialMedia(t){var a=0,e=[{id:a++,text:"twitter",url:"https://twitter.com/intent/tweet?url=http://50-jahre-hitparade.ch/map/",scale:28,y:0,path:"M24.253 8.756C24.69 17.08 18.297 24.182 9.97 24.62c-3.122.162-6.22-.646-8.86-2.32 2.702.18 5.375-.648 7.507-2.32-2.072-.248-3.818-1.662-4.49-3.64.802.13 1.62.077 2.4-.154-2.482-.466-4.312-2.586-4.412-5.11.688.276 1.426.408 2.168.387-2.135-1.65-2.73-4.62-1.394-6.965C5.574 7.816 9.54 9.84 13.802 10.07c-.842-2.738.694-5.64 3.434-6.48 2.018-.624 4.212.043 5.546 1.682 1.186-.213 2.318-.662 3.33-1.317-.386 1.256-1.248 2.312-2.4 2.942 1.048-.106 2.07-.394 3.02-.85-.458 1.182-1.343 2.15-2.48 2.71z"},{id:a++,text:"facebook",url:"https://www.facebook.com/sharer/sharer.php?u=http://50-jahre-hitparade.ch/map/",scale:700,y:-100,path:"m 346.5,712.36218 0,-222.5 -75,0 0,-86.5 75,0 0,-66 c 0,-69.18633 42.89263,-112.18866 110.45353,-112.18866 40.67053,0 68.04647,3.18866 68.04647,3.18866 l 0,78 -45.82143,0 c -29.03699,0 -42.67857,10.21289 -42.67857,41 l 0,56 85.5,0 -11,86.5 -74.5,0 0,222.5 z"},{id:a++,text:"LinkedIn",url:"https://www.linkedin.com/shareArticle?url=http://50-jahre-hitparade.ch/map/",scale:250,y:0,path:"M43.8027344,98.8271484H79.921875v116.0371094H43.8027344V98.8271484z M61.8754883,41.1425781  c11.5478516,0,20.9125977,9.3769531,20.9125977,20.9067383c0,11.5410156-9.3647461,20.9160156-20.9125977,20.9160156  c-11.5908203,0-20.9326172-9.375-20.9326172-20.9160156C40.9428711,50.5195313,50.284668,41.1425781,61.8754883,41.1425781 M102.5664063,98.8271484H137.15625v15.859375h0.4912109  c4.8105469-9.1293945,16.5898438-18.7436523,34.1455078-18.7436523c36.5107422,0,43.265625,24.0214844,43.265625,55.2729492  v63.6484375h-36.0537109v-56.4160156c0-13.46875-0.265625-30.7807617-18.7558594-30.7807617  c-18.7802734,0-21.6425781,14.6577148-21.6425781,29.784668v57.4121094h-36.0400391V98.8271484z"}],r=t.append("g").attr("class","socialMediaButtons").attr("transform","translate("+.85*dimensions.stars.width+", "+.95*dimensions.stars.height+")");for(var i in e){var s=e[i],n=r.append("g").attr("class","socialMediaButtonGroup").attr("transform","translate("+30*s.id+", 0)").on("click",function(t){return window.open(t.url,"_blank")});n.data([s]),n.append("path").attr("transform","scale("+19/s.scale+") translate(5, "+s.y+")").attr("d",s.path).attr("id",s.text)}}function drawHitparadeLogo(t){function a(){window.open("http://www.hitparade.ch","_blank")}var e=t.append("g").attr("transform","translate("+.5*dimensions.stars.width+" "+.95*dimensions.stars.height+")").attr("class","logoImage");myUtil.addImage(e,"./images/LOGO-HITPARADE.svg",.3*dimensions.stars.width,.03*dimensions.stars.height),e.on("touch",a),e.on("click",a)}function addInfoPanel(){var t=overallContainer.append("g").attr("id","infoPanel");t.on("click",removeInfoPanel);t.append("div").attr("id","overlayContainer");t.append("img").attr("src","./images/Erklaerung-svg-mobile.svg").attr("id","infoImage").attr("alt"," ").attr("width",dimensions.width).attr("height",dimensions.height).attr("style","margin-top: 0px")}function removeInfoPanel(){overallContainer.select("#infoPanel").remove()}function showImpressum(){var t=overallContainer.append("g").attr("id","impressumPanel").attr("style","width: 100%; height: 100%}"),a=t.append("div").attr("id","impressumContainer").attr("class","darkBlue");a.on("click",removeImpressum);var e=t.append("div").attr("id","impressumTextContainer"),r=[{tag:"p",value:"The Map",attr:{class:"mediumBold lightPink"}},{tag:"p",value:"All 10'939 Songs and more",attr:{class:"mediumThin white"},break:2},{tag:"p",value:"Check out the cool flight through",attr:{class:"mediumThin white"},break:0},{tag:"p",value:"50 years swiss music charts (ranks 1-15).",attr:{class:"mediumThin white"},break:0},{tag:"p",tags:[{tag:"a",value:"50-Jahre-Hitparade.ch",attr:{class:"mediumThin white",href:"http://50-Jahre-Hitparade.ch/",target:"_blank"}}],break:1},{tag:"p",value:"This experience is made possible by data",attr:{class:"mediumThin white"},break:0},{tag:"p",value:"from ",attr:{class:"mediumThin white",style:"display: inline;"},break:0},{tag:"p",tags:[{tag:"a",value:"hitparade.ch",attr:{class:"mediumThin white",href:"https://hitparade.ch",target:"_blank"},break:0}],attr:{style:"display: inline;"},break:0},{tag:"p",value:" and ",attr:{class:"mediumThin white",style:"display: inline;"},break:0},{tag:"p",tags:[{tag:"a",value:"spotify.com",attr:{class:"mediumThin white",href:"https://spotify.com",target:"_blank"},break:3}],attr:{style:"display: inline;"},break:1},{tag:"p",value:"Idea, Concept &",attr:{class:"mediumThin lightPink"},break:0},{tag:"p",value:"Data Visualization",attr:{class:"mediumThin lightPink"},break:1},{tag:"p",tags:[{tag:"a",attr:{class:"mediumThin white",href:"http://www.d1-solutions.com/",target:"_blank"},tags:[{tag:"img",attr:{id:"doneLogo",class:"logoImage",src:"./images/LOGO-DONE.svg",alt:" ",width:"30%"},break:3}],break:0}],attr:{style:"display: inline;"},break:0},{tag:"p",value:"Concept, Design &",attr:{class:"mediumThin lightPink"},break:0},{tag:"p",value:"Development",attr:{class:"mediumThin lightPink"},break:1},{tag:"p",tags:[{tag:"a",attr:{class:"mediumThin white",href:"http://www.hinderlingvolkart.com/",target:"_blank"},tags:[{tag:"img",attr:{id:"hvLogo",class:"logoImage",src:"./images/LOGO-HV.svg",alt:" ",width:"25%"},break:3}],break:0}],attr:{style:"display: inline;"},break:3},{tag:"p",value:"General Contact:",attr:{class:"mediumThin lightPink"},break:0},{tag:"p",tags:[{tag:"a",value:"dj@50-Jahre-Hitparade.ch",attr:{class:"mediumThin white",href:"mailto:dj@50-Jahre-Hitparade.ch"},break:3}],break:1},{tag:"p",value:"Â© D ONE AG & Hinderling Volkart",attr:{class:"mediumThin white"},break:0}];writeTags(e,r)}function writeTags(t,a){for(var e in a){var r=t.append(a[e].tag);null!=a[e].value&&r.text(a[e].value);for(var i in a[e].attr)r.attr(i,a[e].attr[i]);for(var i=0;i<a[e].break;i++)t.append("br");null!=a[e].tags&&writeTags(r,a[e].tags)}}function removeImpressum(){overallContainer.select("#impressumPanel").remove()}function drawControls(t){var a=[];a.push({id:"showAll",text:"All 10'939 Songs",action:"showAll"}),a.push({id:"numberOnesOnlyButton",text:"#1 Songs",action:"showNumberOnesOnly"}),a.push({id:"theMap",text:"The Map",action:"addInfoPanel"}),a.push({id:"backToAnalysis",text:"Back To Analysis",action:"backToAnalysis"}),a.push({id:"swissOnlyButton",text:"Swiss Songs",action:"showSwissOnly"}),a.push({id:"videoClips",text:"Video Clips",action:"showVideoClips"}),a.push({id:"impressum",text:"Impressum",action:"showImpressum"}),myUtil.addImage(t,"images/50Y-logo.svg",200,80).attr("class","logo").attr("transform","translate(30, 0)");var e=t.append("g").attr("id","menuButtonContainer"),r={x:300,y:6};for(var i in a){4==i&&(r.y=30,r.x=300);var s=a[i],n=e.append("g").attr("id",s.id).attr("class","menuButtonGroup menuButtonGroupInactive").attr("transform","translate("+r.x+", "+r.y+")");n.data([s]),n.on("click",function(t){"impressum"!=t.id&&"theMap"!=t.id&&"backToAnalysis"!=t.id&&(e.selectAll(".menuButtonGroup").attr("class","menuButtonGroup menuButtonGroupInactive"),d3.select(this).attr("class","menuButtonGroup menuButtonGroupActive")),dispatch.call(t.action)}),0==i&&n.attr("class","menuButtonGroup menuButtonGroupActive"),myUtil.addRect(n,0,0,100,30).attr("class","menuButtonBg").attr("rx",10).attr("ry",10),myUtil.addText(n,0,20,[{value:s.text}]).attr("class","menuButtonText unselectable"),r.x=r.x+190}dispatch.on("showNumberOnesOnly",function(){starGroups.topTen.forEach(function(t){1!=t.node().__data__.minRank?t.attr("style","display: none;"):t.attr("style","")}),starGroups.topThirty.forEach(function(t){t.attr("style","display: none;")}),starGroups.rest.forEach(function(t){t.attr("style","display: none")})}),dispatch.on("showSwissOnly",function(){for(var t in starGroups){var a=starGroups[t];for(var e in a){var r=a[e];"ch"==r.node().__data__.Hpch?r.attr("style",""):r.attr("style","display: none;")}}}),dispatch.on("showVideoClips",function(){for(var t in starGroups){var a=starGroups[t];for(var e in a){var r=a[e];null!=r.node().__data__.Hpvideo&&r.node().__data__.Hpvideo.length>0?r.attr("style",""):r.attr("style","display: none;")}}}),dispatch.on("showAll",function(){for(var t in starGroups){var a=starGroups[t];for(var e in a)a[e].attr("style","")}}),dispatch.on("backToAnalysis",function(){window.open("http://www.50-Jahre-Hitparade.ch/analysis/","_blank")}),dispatch.on("showImpressum",showImpressum),dispatch.on("addInfoPanel",addInfoPanel)}function zoom(t){zoomfactor=t,zoomed&&(zoomfactor=1),zoomed=!zoomed,starContainer.selectAll(".star").each(function(t){d3.select(this).attr("transform","translate("+t.xPosition*zoomfactor+", "+t.yPosition+")")});var a=starContainer.select("#timeOverlay");a.selectAll(".timeOverlayHeader").each(function(t){var a=d3.select(this);a.select(".timeHeaderLine").attr("x1",t.xStart*zoomfactor).attr("x2",t.xEnd*zoomfactor),a.select(".timeHeaderText").attr("transform","translate("+t.textPosX*zoomfactor+", "+t.textPosY+")")}),isMobile||(zoomed?a.attr("class","zoomedIn"):a.attr("class","zoomedOut"));var e=a.select("#timeOverlayZoom");e.selectAll(".timeZoomHeaderText").each(function(t){d3.select(this).attr("transform","translate("+t.textPosX*zoomfactor+", "+t.textPosY+")")}),zoomed?e.attr("visibility","visible"):e.attr("visibility","hidden"),starContainer.attr("viewBox","0 0 "+dimensions.stars.width*zoomfactor+" "+dimensions.stars.height-100).attr("width",dimensions.stars.width*zoomfactor)}function starMouseOverAction(t){this.parentElement.appendChild(this);var a=d3.select(this);a.select(".starElementPath").attr("transform","scale(2.5)"),a.select(".starMouseover").attr("visibility","display")}function starMouseOutAction(t){if(!t.active){var a=d3.select(this);mouseOutEvent(a,t)}}function starMouseClickAction(t){if(t.active)stopSong();else{var a="./audio/"+leadingZeros(t.Hpsong_Id)+".mp3";stopSong();var e=overallContainer.append("audio").attr("id","audioElement").attr("src",a);e.node().play(),t.active=!0;var r=d3.select(this);activeStar=r;var i=r.select(".starMouseover"),s=i.select(".starPlayContent"),n=s.append("g").attr("id","starContentPlayer"),o=0,l=[{value:t.Dtfirstbestrank,x:0,dy:0,class:"mediumThin white"}];if(myUtil.addText(n,30,5,l),null!=t.Hpcover&&t.Hpcover.length>0){o=dimensions.stars.mouseover.maxHeight;var d="./covers/"+leadingZeros(t.Hpsong_Id)+".jpg";myUtil.addImage(n,d,140,140).attr("class","coverImage").attr("transform","translate(30, 12)"),i.select(".starMouseoverBg").attr("height",o)}else o=90,i.select(".starMouseoverBg").attr("height",o);if(t.mouseOverTop&&i.attr("transform","translate("+t.starMouseoverX+","+-o+")"),null!=t.Hpvideo&&t.Hpvideo.length>0){var m=n.append("g"),c=t.Hpvideo.replace("http://youtu.be","https://www.youtube.com/embed");c+="?html5=1&autoplay=1&origin=https://50-jahre-hitparade.ch",m.data([{url:c}]);var h=myUtil.addText(m,30,o-dimensions.stars.mouseover.height-10,[{value:"play video",class:"white mediumThin"}]);h.on("click",openVideo)}}}function drawStars(t,a){var e=new Date(1968,0,2),r=new Date(2018,12,0),i={paddingLeft:25,paddingRight:25};i.width=dimensions.stars.width-i.paddingLeft-i.paddingRight,i.height=.63*dimensions.stars.height,dimensions.stars.group=i,dimensions.stars.mouseover={width:200,height:60,maxHeight:240};var s=myUtil.addRect(t,0,0,"100%","100%").attr("id","starGroupBg");s.on("click",stopSong);var n=t.append("g").attr("transform","translate("+i.paddingLeft+", 0)"),o=myUtil.addRect(t,0,0,"100%","100%").attr("id","starLoader");o.on("click",stopSong),dateScale=d3.scaleTime().domain([e,r]).range([0,i.width]),colorScale=d3.scaleLinear().domain([0,.5,1]).range(["#311F66","#ffffff","#E57E2A"]),rankScale=d3.scaleLinear().domain([1,2,10,30,100]).range([.9,.75,.45,.3,.25]);var l=[{yearFrom:1968,yearTo:1969,title:"60's"},{yearFrom:1970,yearTo:1979,title:"70's"},{yearFrom:1980,yearTo:1989,title:"80's"},{yearFrom:1990,yearTo:1999,title:"90's"},{yearFrom:2e3,yearTo:2009,title:"00"},{yearFrom:2010,yearTo:2018,title:"10"}],d=t.append("linearGradient").attr("id","boxGrad").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");d.append("stop").attr("class","boxGradStop1").attr("offset","0%"),d.append("stop").attr("class","boxGradStop2").attr("offset","100%");var m=n.append("g").attr("id","timeOverlay");m.on("click",function(){isMobile||zoom(5)}),isMobile||m.attr("class","zoomedOut");var c=m.append("g").attr("id","timeOverlayZoom").attr("visibility","hidden");for(var h in l){myTimeHeader=l[h],myTimeHeader.xStart=parseInt(dateScale(new Date(myTimeHeader.yearFrom,0,2))+5),myTimeHeader.xEnd=parseInt(dateScale(new Date(myTimeHeader.yearTo,12,0))-5),myTimeHeader.textPosX=parseInt(myTimeHeader.xStart+(myTimeHeader.xEnd-myTimeHeader.xStart)/2),myTimeHeader.textPosY=12;var p=m.append("g").attr("class","timeOverlayHeader");p.data([myTimeHeader]),myUtil.addHorizontalLine(p,myTimeHeader.xStart,16,myTimeHeader.xEnd-myTimeHeader.xStart,0).attr("class","timeHeaderLine").attr("vector-effect","non-scaling-stroke"),myUtil.addText(p,myTimeHeader.textPosX,myTimeHeader.textPosY,[{value:myTimeHeader.title}]).attr("class","timeHeaderText");for(var u=myTimeHeader.yearFrom;u<=myTimeHeader.yearTo;u++){var v=parseInt(dateScale(new Date(u,0,2)));myUtil.addText(c,v,30,[{value:u}]).attr("class","timeZoomHeaderText mediumBold").data([{textPosX:v,textPosY:30}])}}drawStarsForData(n,a),util.loadData(0,[{key:"topTwenty",path:"./data/daten_topTwenty.csv"}],function(t){drawStarsForData(n,t.topTwenty),util.loadData(0,[{key:"rest",path:"./data/daten_rest.csv"}],function(t){drawStarsForData(n,t.rest),o.remove()})})}function drawStarsForData(t,a){var e=dimensions.stars.group;for(var r in a){var i=a[r];i.active=!1;var s=parseDate(i.Hpentry);if(i.xPosition=parseInt(dateScale(s)),i.yPosition=parseInt((1-i.Sdanceability_random)*e.height+30),!isNaN(i.yPosition)){var n=t.append("g").attr("class","star");n.attr("transform","translate("+i.xPosition+", "+i.yPosition+")");var o=rankScale(i.minRank);isNaN(o)&&(o=.003),i.scaleFactor=o;var l=n.append("g").attr("class","starMouseover").attr("visibility","hidden");i.mouseOverLeft=i.xPosition>dimensions.stars.width-dimensions.stars.mouseover.width,i.mouseOverTop=i.yPosition>dimensions.stars.height-dimensions.stars.mouseover.maxHeight,i.starMouseoverX=0,i.starMouseoverY=0,i.mouseOverLeft&&(i.starMouseoverX-=dimensions.stars.mouseover.width),i.mouseOverTop&&(i.starMouseoverY-=dimensions.stars.mouseover.height),l.attr("transform","translate("+i.starMouseoverX+", "+i.starMouseoverY+")"),n.data([i]);var d=(myUtil.addRect(l,0,0,dimensions.stars.mouseover.width,dimensions.stars.mouseover.height).attr("class","starMouseoverBg"),l.append("g").attr("class","starPlayContent").attr("transform","translate(0, "+dimensions.stars.mouseover.height+")"),[{value:shortenString(i.Artist,21,5),class:"mediumThin lightPink"},{value:shortenString(i.Hptitle,21,5),x:0,dy:17,class:"mediumBold lightPink"},{value:"Beste Platzierung: "+i.minRank,x:0,dy:17,class:"mediumThin white"}]),m=myUtil.addText(l,30,17,d).attr("class","starMouseoverText");(i.Artist.length>21||i.Hptitle.length>21)&&m.append("title").text(i.Artist+"\n"+i.Hptitle);var c=n.append("polyline").attr("class","starElementPath").attr("points","0, -5.7 -1.6, -0.7 -6.8, -0.7 -2.6, 2.4 -4.2, 7.4 0, 4.3 4.3, 7.4 2.6, 2.4 6.9, -0.7 1.6, -0.7 0, -5.7 ").attr("transform","scale("+o+")");n.on("mouseover",starMouseOverAction),n.on("touch",starMouseOverAction),n.on("mouseout",starMouseOutAction),n.on("click",starMouseClickAction),n.on("touch",starMouseClickAction);var h=colorScale(i.Svalence);a[r].Svalence<0&&(h="#D15B93"),c.attr("fill",h),i.minRank<10?starGroups.topTen.push(n):i.minRank<30?starGroups.topThirty.push(n):starGroups.rest.push(n)}}}function mouseOutEvent(t,a){t.select(".starElementPath").attr("transform","scale("+a.scaleFactor+")"),t.select(".starMouseover").attr("visibility","hidden")}function stopSong(){overallContainer.selectAll("#audioElement").remove(),starContainer.select("#starContentPlayer").remove(),null!=activeStar&&(activeStar.node().__data__.active=!1,mouseOutEvent(activeStar,activeStar.node().__data__),activeStar.select(".starMouseoverBg").attr("height",60),activeStar.select(".starMouseover").attr("transform","translate("+activeStar.node().__data__.starMouseoverX+","+activeStar.node().__data__.starMouseoverY+")"))}function openVideo(t){var a=overallContainer.append("div").attr("id","videoPlayContainer"),e=a.append("div").attr("id","overlayContainer");e.on("click",closeVideo),overallContainer.selectAll("#audioElement").remove();var r=a.append("div").attr("id","videoContainer");r.append("iframe").attr("id","ytplayer").attr("type","text/html").attr("width",560).attr("height",349).attr("src",t.url).attr("frameborder",0)}function closeVideo(){d3.select(videoPlayContainer).remove()}function leadingZeros(t){var a=t+"",e="0000000";return e.substring(a.length,14)+a}function shortenString(t,a,e){return null!=t&&t.length>a?t.substring(0,a-e-2)+"..."+t.substring(t.length-e,t.length):t}var myUtil=new util,parseDate=d3.timeParse("%m.%d.%Y"),logger=myUtil.logger;logger.mode=0;var zoomed=!1,activeStar=null,overallContainer=d3.select("#overall_container"),mainContainer,dimensions,controlContainer,starContainer,dispatch=d3.dispatch("showAll","showNumberOnesOnly","showSwissOnly","addInfoPanel","showVideoClips","showImpressum","backToAnalysis"),starGroups={topTen:[],topThirty:[],rest:[]},isMobile=!1;/Mobi/.test(navigator.userAgent)&&(isMobile=!0);var touchEnabled=isTouch();mainContainer=overallContainer.append("div").attr("id","mainContainer");var loadImage=mainContainer.append("img").attr("src","./images/Logo-The_MAP.svg").attr("alt"," ").attr("width",window.innerWidth).attr("height",window.innerHeight);window.onload=function(){var t=[];t.push({key:"sternenhimmel",path:"./data/daten_topFive.csv"}),util.loadData(0,t,function(t){loadImage.remove(),dimensions={width:window.innerWidth,height:window.innerHeight},isMobile&&(dimensions.width*=10),dimensions.controlls={width:dimensions.width,height:100},dimensions.stars={width:dimensions.width,height:dimensions.height-dimensions.controlls.height},controlContainer=svghandler.init(mainContainer,dimensions.controlls.width,dimensions.controlls.height,dimensions.controlls.width,100,"controlContainer",!1),starContainer=svghandler.init(mainContainer,dimensions.stars.width,dimensions.stars.height,dimensions.stars.width,dimensions.stars.height,"starContainer",!1).attr("height",dimensions.stars.height).attr("preserveAspectRatio","none"),drawStars(starContainer,t.sternenhimmel),drawControls(controlContainer),drawHitparadeLogo(starContainer),addSocialMedia(starContainer),isMobile&&zoom(1)})};var dateScale,colorScale,rankScale;